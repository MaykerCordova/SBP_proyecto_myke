import polars as pl
import plotly.express as px

# Cargar Data
# Asegurate de que header=4 si las primeras lineas son basura
df = pl.read_excel("TU_ARCHIVO_MONITOR.xlsx", sheet_id=1, read_csv_options={"has_header": False, "skip_rows": 4})

# 1. Verificación de Nombres de Columnas
print("Columnas encontradas:", df.columns)

# 2. Análisis de Entry Mode (¿Tengo ataques de banda?)
print("\n--- Distribución de Entry Mode ---")
print(df["ACF-ENTRY MODE"].value_counts())

# 3. Análisis de Códigos de Respuesta
print("\n--- Top Errores (Posible Fraude) ---")
print(df["ACF-COD RPTA"].value_counts().head(10))

# 4. Correlación entre Score de Monitor y Monto
# (Requiere limpieza previa si vienen como texto)
try:
    df_clean = df.with_columns([
        pl.col("ACF-MONTO ORIGINAL TRX").cast(pl.Float64),
        pl.col("SCORE DINAMICO").cast(pl.Float64)
    ])
    corr = df_clean.select(pl.corr("ACF-MONTO ORIGINAL TRX", "SCORE DINAMICO")).item()
    print(f"\nCorrelación Monto vs Score Monitor: {corr}")
except:
    print("No se pudo calcular correlación (revisar tipos de datos)")
